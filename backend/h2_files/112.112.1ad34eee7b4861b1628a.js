(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{811:function(t,e,n){"use strict";n.r(e);var r=n(8),a=n.n(r),s=n(10),i=n.n(s),c=n(13),o=n.n(c),u=n(50),l=n(220),h=n(2),d=n.n(h),f=n(0),v=n.n(f),m=n(139),y=n.n(m),g=n(3),p=n(7),I=n(1);function k(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k(Object(n),!0).forEach((function(e){a()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var W="watchlist-tray";function P(){return O.apply(this,arguments)}function O(){return(O=d()(v.a.mark((function t(){var e,n,r;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=p.a.getUserSubsStatusHeader(),t.next=3,p.a.getUserToken();case 3:return n=t.sent,r=Object.assign({subsStatusHeader:e,userToken:n},g.a.configuration),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var w={getWatchlist:function(){return{remote:(t=d()(v.a.mark((function t(e){var n,r,a,s,i,c,o,u,l,h,d,f=arguments;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:{},t.next=3,P(g.a.configuration);case 3:return r=t.sent,a=r.userToken,s=p.a.getPID(),c=(i=n||{}).disableMeta,o=void 0!==c&&c,u=i.limit,l=void 0===u?I.f.PAGINATION_SIZE:u,h=i.offset,d=void 0===h?0:h,i.skipCache&&(r.skipCache=!0),t.abrupt("return",y.a.getWatchlist({config:r,userId:s,userToken:a,disableMeta:o,limit:l,offset:d}));case 9:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)}),local:function(){return null},success:l.a.getWatchlistSuccess,error:l.a.getWatchlistFailure};var t},getNextPageWatchList:function(){return{remote:(t=d()(v.a.mark((function t(e){var n,r,a,s,i,c,o=arguments;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},t.next=3,P(g.a.configuration);case 3:return r=t.sent,a=r.userToken,s=p.a.getPID(),i=(n||{}).offset,c=void 0===i?0:i,r.skipCache=!0,t.abrupt("return",y.a.getWatchlist({config:r,userId:s,userToken:a,limit:I.f.PAGINATION_SIZE,offset:c}));case 9:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)}),local:function(){return null},success:l.a.getNextPageWatchListSuccess,error:l.a.getNextPageWatchListFailure};var t},getWatchListIds:function(){return{remote:(t=d()(v.a.mark((function t(){var e,n,r;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P(g.a.configuration);case 2:return e=t.sent,n=e.userToken,r=p.a.getPID(),t.abrupt("return",y.a.getWatchlist({config:e,userId:r,userToken:n,disableMeta:!0,limit:100}));case 6:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)}),local:function(){return null},success:l.a.getWatchListIdsSuccess,error:l.a.getWatchListIdsFailure};var t},addToWatchlist:function(){return{remote:(t=d()(v.a.mark((function t(e,n){var r;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=b,t.t1=b({},n),t.next=4,P();case 4:return t.t2=t.sent,r=(0,t.t0)(t.t1,t.t2),t.abrupt("return",y.a.addToWatchlist(r));case 7:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)}),local:function(){return null},success:l.a.addToWatchlistSuccess,error:l.a.addToWatchlistFailure};var t},removeFromWatchlist:function(){return{remote:(t=d()(v.a.mark((function t(e,n){var r;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=b,t.t1=b({},n),t.next=4,P();case 4:return t.t2=t.sent,r=(0,t.t0)(t.t1,t.t2),t.abrupt("return",y.a.removeFromWatchlist(r));case 7:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)}),local:function(){return null},success:l.a.removeFromWatchlistSuccess,error:l.a.removeFromWatchlistFailure};var t},removeBulkFromWatchlist:function(){return{remote:(t=d()(v.a.mark((function t(e,n){var r,a;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P();case 2:return r=t.sent,a=n.map((function(t){var e=b(b({},t),r);return y.a.removeFromWatchlist(e)})),t.abrupt("return",Promise.all(a));case 5:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)}),local:function(){return null},success:l.a.removeBulkFromWatchlistSuccess,error:l.a.removeBulkFromWatchlistFailure};var t},getLocalWatchlist:function(){return{remote:function(t,e){var n=e.userId,r={reqModule:W,reqKey:n};return y.a.rucGetItem(r,"RUC").then((function(t){var n=t.contentIds,r=void 0===n?[]:n;e.assets.items=r;var a={contentIds:r,config:{}};return y.a.getMultiContentDetails(a)})).then((function(t){var n,r;return e.assets.items=(n=e.assets.items,r=t.results.map,n.filter((function(t){return!!r[t]})).map((function(t){return r[t]}))),e.status=!0,e})).catch((function(){return e.assets.items=[],e}))},local:function(){return null},success:l.a.getLocalWatchlistSuccess,error:l.a.getLocalWatchlistFailure}},setLocalWatchlist:function(){return{remote:function(t,e){var n=e.assets,r=void 0===n?{}:n,a=e.userId,s=r.items,i=(void 0===s?[]:s).map((function(t){return t.contentId})),c={reqModule:W,reqKey:a,reqData:{contentIds:i}};return y.a.rucSetItem(c,"RUC")},local:function(){return null},success:l.a.setLocalWatchlistSuccess,error:l.a.setLocalWatchlistFailure}}},F=n(27),_=n(36),x=n(5),L=n(22),S=n(43),T=n(18);function D(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function N(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?D(Object(n),!0).forEach((function(e){a()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var j="web__info__ums__ADDED_TO_WATCHLIST",C="web__info__ums__REMOVE_FROM_WATCHLIST",E=function(){function t(){i()(this,t),this.initStore(),this.bindActions(l.a),this.bindAction(L.a.hideSignInModal,this.removeQueuedContent),this.exportAsync(w)}return o()(t,[{key:"initStore",value:function(){this.contentIds={},this.isFetchedAllids=!1,this.trays=[],this.wlTrayDetails={},this.haveNextPage=!1,this.loadMoreItems=!1,this.cardsPerPage=0,this.trayDataLoader=!0,this.selectable=!1,this.bulkEdit={},this.queueContent=null,this.imageType=I.f.IMG_TYPE.HORIZONTAL,this.initTryData=!1}},{key:"removeQueuedContent",value:function(){this.queuedContent=null}},{key:"queueContent",value:function(t){t.userId=p.a.getPID(),this.queuedContent=t}},{key:"flushQueue",value:function(){this.queuedContent&&(this.addToWatchlist(this.queuedContent),this.removeQueuedContent())}},{key:"getWatchListIds",value:function(t){!t&&this.isFetchedAllids||this.getInstance().getWatchListIds()}},{key:"getWatchListIdsSuccess",value:function(t){var e=t.assets,n=(void 0===e?{}:e).itemids,r=void 0===n?[]:n;this.isFetchedAllids=!0,this.updateWatchlistIds(r)}},{key:"updateWatchlistIds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=t.filter((function(t){return!!t})).reduce((function(t,e){return t[e]=!0,t}),{});this.contentIds=e}},{key:"getWatchlist",value:function(t){!(t||{}).skipCache&&this.trays.length||(this.trayDataLoader=!0,this.getInstance().getWatchlist(t))}},{key:"addCardForRemoval",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.contentId;this.bulkEdit[e]=t}},{key:"removeCardForRemoval",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.contentId;delete this.bulkEdit[e]}},{key:"resetBulkEdit",value:function(){this.bulkEdit={}}},{key:"bulkRemoveFromWatchlist",value:function(){var t=this,e=Object.keys(this.bulkEdit),n=p.a.getPID();if(e.length){var r=e.map((function(e,r){var a=t.bulkEdit[e];a.userId=n;var s=a.trayInfo,i=void 0===s?{}:s,c=a.contentType,o=void 0===c?"":c,u=i.trayName,l=void 0===u?"":u,h={content_id:e,content_type:o,total_items_in_watchlist:Object.keys(t.contentIds).length-r-1,referrer_type:l?"tray":"page"};return F.a.fireRemovedFromWatchlist(h),a}));r.forEach((function(e){return t.hideItemLocally(e)})),this.getInstance().removeBulkFromWatchlist(r)}}},{key:"removeBulkFromWatchlistSuccess",value:function(t){var e=this,n=0;Array.isArray(t)&&t.forEach((function(t){var r=t.status,a=t.content;r?(e.removeItemLocally(a),e.removeCardForRemoval(a),n+=1):e.removeFailureFallback(a)})),n&&(L.a.showSnackbar({text:Object(T.e)(C)}),this.selectable=!1)}},{key:"startEditMode",value:function(){this.selectable=!0}},{key:"stopEditMode",value:function(){this.selectable=!1}},{key:"getWatchlistSuccess",value:function(t){var e=t.status;this.trayDataLoader=!1,e&&this.updateWatchlist(t)}},{key:"updateWatchlist",value:function(t){var e=t.assets,n=void 0===e?{}:e,r=t.haveNextPage,a=n.items,s=void 0===a?[]:a;this.haveNextPage=!!r,this.wlTrayDetails=t,this.initTryData=!0,s.forEach((function(t){t.linkUrl||(t.linkUrl=x.a.getDetailUrl(t))})),this.trays=s,this.flushQueue()}},{key:"addToWatchlist",value:function(t){delete(t=S.a.getNewObjectCopy(t)).percentage,t.meta&&delete t.meta.percentage,t.userId=p.a.getPID(),t.linkUrl||(t.linkUrl=x.a.getDetailUrl(t));var e=t.trayInfo,n=(void 0===e?{}:e).trayName,r=void 0===n?"":n,a={content_id:_.a.getId(t),content_type:_.a.getContentType(t),is_premium:_.a.isPremiumContent(t),total_items_in_watchlist:Object.keys(this.contentIds).length+1,referrer_type:r?"tray":"page"};F.a.fireAddedToWatchlist(a),this.addItemLocally(t),this.getInstance().addToWatchlist(t)}},{key:"addItemLocally",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t&&t.contentId&&(this.contentIds[t.contentId]=!0,this.trays=this.trays.slice(0,e).concat(t).concat(this.trays.slice(e)))}},{key:"addFailureFallback",value:function(t){this.removeItemLocally(t)}},{key:"hideItemLocally",value:function(t){t&&t.contentId&&(delete this.contentIds[t.contentId],this.trays=this.trays.map((function(e){return Number(e.contentId)===Number(t.contentId)?N(N({},e),{},{hide:!0}):e})))}},{key:"removeItemLocally",value:function(t){t&&t.contentId&&(delete this.contentIds[t.contentId],this.trays=this.trays.filter((function(e){return Number(e.contentId)!==Number(t.contentId)})))}},{key:"removeFailureFallback",value:function(t){t&&t.contentId&&(this.contentIds[t.contentId]=!0,this.trays=this.trays.map((function(e){return Number(e.contentId)===Number(t.contentId)?N(N({},e),{},{hide:!1}):e})))}},{key:"addToWatchlistSuccess",value:function(t){var e=t.status,n=t.content;e?L.a.showSnackbar({text:Object(T.e)(j)}):this.addFailureFallback(n)}},{key:"removeFromWatchlist",value:function(t){t.userId=p.a.getPID();var e=t.trayInfo,n=(void 0===e?{}:e).trayName,r=void 0===n?"":n,a={content_id:_.a.getId(t),content_type:_.a.getContentType(t),is_premium:_.a.isPremiumContent(t),total_items_in_watchlist:Object.keys(this.contentIds).length-1,referrer_type:r?"tray":"page"};F.a.fireRemovedFromWatchlist(a),this.hideItemLocally(t),this.getInstance().removeFromWatchlist(t)}},{key:"removeFromWatchlistSuccess",value:function(t){var e=t.status,n=t.content;e?(this.removeItemLocally(n),L.a.showSnackbar({text:Object(T.e)(C)}),this.selectable=!1):this.removeFailureFallback(n)}},{key:"getNextPageWatchList",value:function(){var t=this.trays.length;t&&this.haveNextPage&&!this.loadMoreItems&&(this.loadMoreItems=!0,this.getInstance().getNextPageWatchList({offset:t}))}},{key:"getNextPageWatchListSuccess",value:function(t){var e=t.assets,n=void 0===e?{}:e,r=t.haveNextPage,a=n.items,s=void 0===a?[]:a;this.loadMoreItems=!1,this.haveNextPage=!!r,this.trays=this.trays.concat(s)}},{key:"getNextPageWatchListFailure",value:function(){this.loadMoreItems=!1}},{key:"setPagination",value:function(t){this.cardsPerPage=t}},{key:"setActivePageIndex",value:function(t){this.haveNextPage&&(this.trays.length-(t+this.cardsPerPage)-1>this.cardsPerPage||this.getNextPageWatchList())}},{key:"hasNextPage",value:function(){return!!this.haveNextPage}},{key:"setInitialData",value:function(t){this.trayDataLoader=!1,this.loadMoreItems=!1,this.initTryData||this.updateWatchlist(t)}},{key:"recycleStore",value:function(){this.initStore(),this.getWatchlist({skipCache:!0})}}]),t}();e.default=u.a.createStore(E,"WatchlistStore")}}]);